
<!DOCTYPE html>
<html>
	
<head>
	<meta charset="utf-8">
	<meta name="description" content="ZipHttpd document selector">
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<title>ZipHttpd document selector</title>
	<link rel="icon" href="./static/favicon.ico">
	<link type="text/css" rel="stylesheet" href="./static/sign.css" />

	<script src="./static/CompElem.js"></script>
<script>
class Repository {
	list() {
		return wget("/api/list");
	}
	regist(site, group) {
		// TODO: パスワード入力
		const password = "password";
		return wpost("/api/regist/"
			, {"X-Requested-With": password}
			, {"site":site, "group":group});
	}
	wget(path) {
		return new Promise(function(callback,onerror) {
			const xhr=new XMLHttpRequest();
			xhr.open("GET", path);
			xhr.onreadystatechange=function() {
				if(xhr.readyState==4) {
					switch(xhr.status) {
						case 200:	// OK
							callback(xhr.response);
							break;
						default:
							onerror(xhr.response);
							break;
					}
				}
			}
			xhr.send();
		});
	}
	wpost(path, headerData, formData) {
		return new Promise(function(callback,onerror) {
			const xhr=new XMLHttpRequest();
			xhr.open("POST", path);
			for (key in headerData.Keys()) {
				xhr.setRequestHeader(key, headerData[key]);
			}
			xhr.onreadystatechange=function() {
				if(xhr.readyState==4) {
					switch(xhr.status) {
						case 200:	// OK
							callback(xhr.response);
							break;
						default:
							onerror(xhr.response);
							break;
					}
				}
			}
			const form = new FormData();
			for (key in formData.keys()) {
				form.append(key, formData[key]);
			}
			xhr.send(form);
		});
	}
}
</script>
</head>
<h1>test</h1>
</html>
